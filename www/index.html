<!DOCTYPE html>
<html lang="en">
    <head>
        <title>Firebase Web Demo App</title>
        <meta name="viewport" content="user-scalable=yes, initial-scale=1, maximum-scale=1, minimum-scale=1, width=device-width, height=device-height" />
        <link rel="stylesheet" type="text/css" href="bootstrap/css/bootstrap.css">
        <link rel="stylesheet" type='text/css' href="css/semantic.css">
        <link rel="stylesheet" type='text/css' href="css/loading.css">
        <link rel="stylesheet" type='text/css' href="font-awesome/css/font-awesome.min.css">
        <link rel='stylesheet' type='text/css' href='https://fonts.googleapis.com/css?family=Roboto'>
        <style type="text/css">
            body{
                font-family: Roboto;
            }
        </style>
    </head>
    <body>
        <div class="ui container">
            <br>
            <div class="row">
                <!--<div class="col-lg-1">
                    <div class="table">
                        <div class="ui red message">
                            <span id="msg"></span>
                        </div>
                        <table id="tbldata" class="table table-bordered" style="font-size: 10px;"></table>
                    </div>
                </div>-->
                <div class="col-lg-12 text-left">

                </div>
            </div>
        </div>
        <div id="googleMap" style="width:100%; height:100%; position: absolute; top: 0px; left: 0px;"></div>
    </body>
</html>
<script type="text/javascript" src="https://www.gstatic.com/firebasejs/3.6.2/firebase.js"></script>
<script type="text/javascript" src="http://maps.googleapis.com/maps/api/js?key=AIzaSyAvCB0fJALK-4VaEiubgiVYuh-pJxNGvH0"></script>
<script type="text/javascript" src="js/jquery1.11.1-min.js"></script>
<script type="text/javascript">
    var config = {
      apiKey: "AIzaSyA-qB_P4ILz6FHSEVLydbd4_R8jXGBWthM",
      authDomain: "api-project-234444986540.firebaseapp.com",
      databaseURL: "https://api-project-234444986540.firebaseio.com/"
    };

    firebase.initializeApp(config);

    var rootRef = firebase.database().ref();
    var coords = [], colors = ["#38c6f3", "#4a5ba9", "#34e4b8", "#166048", "#291f09", "#800000", "#0000ff", "#ff0000", "#512411", "#e3af0c"];
    $(function(){
        $(".message").hide();
        $("#tbldata").empty();

        var mapProp = {
            center: new google.maps.LatLng(14.2599286, 80.1137635),
            zoom: 17,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            panControl: false,
            zoomControl: false,
            scaleControl: false,
            mapTypeControl: false,
            streetViewControl: false,
            overviewMapControl: false,
            rotateControl: false
        };

        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

        var marker1 = new google.maps.Marker({
            position: new google.maps.LatLng(14.2599286,80.1137635),

            /*icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 5,
                strokeWeight: 2,
                strokeColor: "#007ff4",
                strokeOpacity: 0.8,

                fillColor: "#57c8ff",
                fillOpacity: 0.8
            },*/
            icon: "img/icon.png",

            draggable: false,
            map: map
        });

        /*rootRef.once("value", function(snapshot) {
            var endMarker = new google.maps.Marker();
            if(snapshot.exists()){
                $(".message").hide();
                $("#tbldata").empty();

                snapshot.forEach(function(data){
                    //debugger;
                    //$("#tbldata").append("<tr><td colspan='3'><p class='text-danger'>" + data.key + "</p></td></tr>");
                    var i = data.val().length, k = 0;
                    coords = [];
                    if(i > 0){

                        for(var j = 0; j < i; j++){

                            try {
                                k = k + 1;
                                //$("#tbldata").append("<tr><td>" + k + "</td><td>" + data.val()[j].latlng + "</td><td>" + data.val()[j].time + "</td></tr>");
                                coords.push(new google.maps.LatLng(data.val()[j].latlng.split(',')[0], data.val()[j].latlng.split(',')[1]));
                            }
                            catch(e){
                                coords = [];
                                continue;
                            }
                        }
                        var color = colors[0];

                        var tourplan2 = new google.maps.Polyline({
                            path: coords,
                            strokeColor: color,
                            //strokeOpacity: 0.6,
                            strokeWeight: 2
                        });

                        var startMarker = new google.maps.Marker({
                            position: coords[0],

                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 5,
                                strokeWeight: 2,
                                strokeColor: "#bc2c30",
                                strokeOpacity: 0.8,

                                fillColor: "#ed4b4f",
                                fillOpacity: 0.8
                            },

                            draggable: false,
                            map: map
                        });

                        endMarker.setMap(null);
                        endMarker = new google.maps.Marker({
                            position: coords[coords.length - 1],

                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 5,
                                strokeWeight: 2,
                                strokeColor: "#35835e",
                                strokeOpacity: 0.8,

                                fillColor: "#63a79b",
                                fillOpacity: 0.8
                            },

                            draggable: false,
                            map: map
                        });

                        tourplan2.setMap(map);
                    }
                 });
                }
                else{
                    $("#tbldata").empty();
                    $(".message").show();
                    $("#msg").html("No database found. Please check.");
                    LoadMap();
                }
        });*/

        var startMarker = new google.maps.Marker({map: null});
        var endMarker = new google.maps.Marker({map: null});
        var tourplan = new google.maps.Polyline({map: null});
        rootRef.on('value', function(snapshot){
            if(snapshot.exists()){
                var colorNo = 0;
                $(".message").hide();
                $("#tbldata").empty();
                //debugger;

                snapshot.forEach(function(data){
                    startMarker.setMap(null);
                    endMarker.setMap(null);
                    tourplan.setMap(null);

                    //$("#tbldata").append("<tr><td colspan='3'><p class='text-danger'>" + data.key + "</p></td></tr>");
                    var i = Object.values(data.val()).length, k = 0;
                    coords = [];
                    if(i > 0){

                        for(var j = 0; j < i; j++){
                            /*if(j == 0)
                                $("#tbldata").append("<tr><table class='table table-hover table-bordered'><tr><th>Slno</th><th>Location</th><th>Time</th></tr></tr>");
                            if(j == i)
                                $("#tbldata").append("</table></tr>");*/

                            try {
                                k = k + 1;
                                //$("#tbldata").append("<tr><td>" + k + "</td><td>" + data.val()[j].latlng + "</td><td>" + data.val()[j].time + "</td></tr>");
                                coords.push(new google.maps.LatLng(data.val()[j].latlng.split(',')[0], data.val()[j].latlng.split(',')[1]));
                            }
                            catch(e){
                                coords = [];
                                continue;
                            }
                        }
                        var color = colors[colorNo];
                        if(colorNo == 9){
                            colorNo = 0;
                        }
                        else{
                            colorNo = parseInt(colorNo) + 1;
                        }

                        startMarker = new google.maps.Marker({
                            position: coords[0],
                            icon: {
                                path: google.maps.SymbolPath.CIRCLE,
                                scale: 5,
                                strokeWeight: 2,
                                strokeColor: color,//"#bc2c30",
                                //strokeOpacity: 0.8,
                                fillColor: "#ed4b4f",
                                fillOpacity: 0.8
                            },
                            draggable: false,
                            map: map
                        });

                        map.setCenter(startMarker.getPosition());

                        if(coords.length > 1){
                            endMarker = new google.maps.Marker({
                                position: coords[coords.length - 1],
                                icon: {
                                    path: google.maps.SymbolPath.CIRCLE,
                                    scale: 5,
                                    strokeWeight: 2,
                                    strokeColor: color,//"#35835e",
                                    //strokeOpacity: 0.8,
                                    fillColor: "#63a79b",
                                    fillOpacity: 0.8
                                },
                                draggable: false,
                                map: map
                            });
                            map.setCenter(endMarker.getPosition());
                        }

                        tourplan = new google.maps.Polyline({
                            path: coords,
                            strokeColor: color,
                            //strokeOpacity: 0.6,
                            strokeWeight: 3
                        });
                        tourplan.setMap(map);
                    }
                 });
            }
            else{
                $("#tbldata").empty();
                $(".message").show();
                $("#msg").html("No database found. Please check.");
                LoadMap();
            }
        });
    });

    function LoadMap(){
        var mapProp = {
            center: new google.maps.LatLng(14.2599286, 80.1137635),
            zoom: 17,
            mapTypeId: google.maps.MapTypeId.ROADMAP,
            panControl: false,
            zoomControl: false,
            scaleControl: false,
            mapTypeControl: false,
            streetViewControl: false,
            overviewMapControl: false,
            rotateControl: false
        };

        var map = new google.maps.Map(document.getElementById("googleMap"), mapProp);

        var marker1 = new google.maps.Marker({
            position: new google.maps.LatLng(14.2599286,80.1137635),

            /*icon: {
                path: google.maps.SymbolPath.CIRCLE,
                scale: 5,
                strokeWeight: 2,
                strokeColor: "#007ff4",
                strokeOpacity: 0.8,

                fillColor: "#57c8ff",
                fillOpacity: 0.8
            },*/
            icon: "img/icon.png",

            draggable: false,
            map: map
        });
    }
</script>
<!--rootRef.child("355666056403785").on('child_removed', function(){
            $("#tbldata").empty();
            rootRef.once("value", function(snapshot) {
                if(snapshot.exists()){
                    $(".message").hide();

                    snapshot.forEach(function(data){
                        $("#tbldata").append("<tr><td colspan='3'><p class='text-danger'>"+ data.key +"</p></td></tr>");
                        var i = data.val().length, k = 0;

                        if(i > 0){
                            for(var j = 0; j < i; j++){
                                if(j == 0)
                                    $("#tbldata").append("<tr><table class='table table-hover table-bordered'><tr><th>Slno</th><th>Location</th><th>Time</th></tr></tr>");
                                if(j == i)
                                    $("#tbldata").append("</table></tr>");
                                k = k + 1;
                                $("#tbldata").append("<tr><td>" + k + "</td><td>" + data.val()[j].latlng + "</td><td>" + data.val()[j].time + "</td></tr>");
                            }
                        }
                     });
                }
                else{
                    $(".message").show();
                    $("#msg").html("No database found. Please check.");
                }
            });
        });*/
        /*var fetchPosts = function(postsRef) {
            postsRef.on('child_added', function(data) {
                debugger;
            });
            postsRef.on('child_changed', function(data) {
                debugger;
            });
            postsRef.on('child_removed', function(data) {
                debugger;
            });
        };*/
        //fetchPosts(rootRef);-->
